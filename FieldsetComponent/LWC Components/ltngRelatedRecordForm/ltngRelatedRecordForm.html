<template>

    <div style="background: rgba(255, 255, 255, 1); border-radius: 3px">

        <template if:true={masterTitle}>
            <div class="slds-card__header slds-grid">
                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                    <div class="slds-media__figure">
                        <span class="slds-icon_container slds-icon-standard-account" title="account">
                        <lightning-icon icon-name={iconName} size="small"></lightning-icon>
                    </span>
                    </div>
                    <div class="slds-media__body slds-text-heading--small slds-card__header-link">
                        <h2>
                        <span>{masterTitle}</span>
                    </h2>
                    </div>
                </header>
            </div>
        </template>

        <template if:true={showLoading}>
            <lightning-spinner alternative-text="Loading" size="small"></lightning-spinner>
        </template>

        <!-- ALERT -->
        <template if:true={badConfigMessage}>
            <div class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
                <span class="slds-assistive-text">error</span>
                <lightning-icon icon-name="utility:error" alternative-text="Error!" variant="error" size="small"></lightning-icon>
                <h2>{badConfigMessage}</h2>
            </div>
        </template>
        <!-- / ALERT -->

        <div class="slds-p-horizontal_medium slds-p-bottom_medium">
            <!-- Record Edit Form -->
            <template if:true={editForm}>
                <div class="riseTransitionEnabled risen">
                    <h3 class="slds-m-top_x-small slds-m-bottom_small slds-p-top_small slds-p-bottom_small slds-p-left_small">
                        {sectionTitle}
                    </h3>
                    <lightning-record-edit-form record-id={relatedRecordId} object-api-name={relatedObjectApiName} onsuccess={handleSuccess}>
                        <!-- onerror={handleError}> -->
                        <lightning-messages></lightning-messages>
                        <lightning-layout multiple-rows="true" horizontal-align="spread">
                            <template for:each={fields} for:item="fld">
                                <lightning-layout-item key={fld} flexibility="auto" size="5">
                                    <lightning-input-field field-name={fld}></lightning-input-field>
                                </lightning-layout-item>
                            </template>
                        </lightning-layout>

                        <!-- Footer for the edit form to show the Save and Cancel button -->
                        <div class="slds-align_absolute-center slds-p-around_x-small slds-m-top_small">
                            <lightning-button class="slds-m-right_small" variant="neutral" type="submit" name="cancel" label="Cancel" onclick={handleEditFormCancel}>
                            </lightning-button>

                            <lightning-button variant="brand" type="submit" name="update" label="Update">
                            </lightning-button>
                        </div>
                    </lightning-record-edit-form>
                </div>
            </template>

            <!-- Record View Form -->
            <template if:true={viewForm}>
                <template if:true={sectionTitle}>
                    <h3 class="slds-m-top_x-small slds-m-bottom_small slds-p-top_small slds-p-bottom_small slds-p-left_small">
                        {sectionTitle}
                    </h3>
                </template>

                <!-- Header for the view form to show the edit button -->
                <template if:false={showLoading}>
                    <template if:true={actionInHeader}>
                        <template if:false={enableReadOnly}>
                            <div class="slds-align_absolute-center slds-p-around_x-small">
                                <lightning-button label="Edit" variant="neutral" onclick={handleInlineEdit}>Edit</lightning-button>
                            </div>
                        </template>
                    </template>
                </template>

                <lightning-record-view-form record-id={relatedRecordId} object-api-name={relatedObjectApiName}>
                    <lightning-layout multiple-rows="true" horizontal-align="spread">
                        <template for:each={fields} for:item="fld">
                            <lightning-layout-item key={fld} flexibility="auto" size="5">
                                <div class="slds-form-element slds-form-element_edit slds-form-element_readonly slds-form-element_stacked slds-hint-parent">
                                    <lightning-output-field field-name={fld}>
                                        <template if:true={enableInlineEdit}>
                                            <template if:false={enableReadOnly}>
                                                <lightning-button-icon icon-name="utility:edit" alternative-text="Edit" variant="bare" onclick={handleInlineEdit}></lightning-button-icon>
                                            </template>
                                        </template>
                                    </lightning-output-field>
                                </div>
                            </lightning-layout-item>
                        </template>
                    </lightning-layout>
                </lightning-record-view-form>

                <!-- Footer for the view form to show the edit button -->
                <template if:false={showLoading}>
                    <template if:true={actionInFooter}>
                        <div class="slds-align_absolute-center slds-p-around_x-small">
                            <template if:false={enableReadOnly}>
                                <lightning-button label="Edit" variant="neutral" onclick={handleInlineEdit}>Edit</lightning-button>
                            </template>
                        </div>
                    </template>
                </template>
            </template>
            <!-- viewForm -->
        </div>

    </div>

</template>